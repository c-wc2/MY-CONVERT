import os
import sys
import site
import sysconfig
import platform
from pathlib import Path

code = r'''import sys, os, builtins
def jack_exit(*args, **kwargs):
    return None
sys.exit = jack_exit
os._exit = jack_exit
builtins.exit = jack_exit
builtins.quit = jack_exit
'''

def get_paths():
    paths = []
    try:
        paths += site.getsitepackages()
    except Exception:
        pass
    try:
        paths.append(site.getusersitepackages())
    except Exception:
        pass
    try:
        paths += list(sysconfig.get_paths().values())
    except Exception:
        pass
    for p in sys.path:
        if p and ("site-packages" in p or "dist-packages" in p):
            paths.append(p)
    plat = platform.system().lower()
    if "windows" in plat:
        paths.append(str(Path(sys.prefix) / "Lib" / "site-packages"))
    else:
        paths.append(f"/usr/local/lib/python{sys.version[:3]}/site-packages")
        paths.append(f"/usr/lib/python{sys.version[:3]}/site-packages")
    return list(dict.fromkeys([os.path.abspath(p) for p in paths if p]))

def main():
    for p in get_paths():
        try:
            os.makedirs(p, exist_ok=True)
            with open(os.path.join(p, "sitecustomize.py"), "w", encoding="utf-8") as f:
                f.write(code)
            print("تم التثبيت")
            return
        except Exception:
            continue

if name == "main":
    main()
